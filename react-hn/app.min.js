!function e(t,n,s){function i(o,r){if(!n[o]){if(!t[o]){var m="function"==typeof require&&require;if(!r&&m)return m(o,!0);if(a)return a(o,!0);var l=new Error("Cannot find module '"+o+"'");throw l.code="MODULE_NOT_FOUND",l}var d=n[o]={exports:{}};t[o][0].call(d.exports,function(e){var n=t[o][1][e];return i(n?n:e)},d,d.exports,e,t,n,s)}return n[o].exports}for(var a="function"==typeof require&&require,o=0;o<s.length;o++)i(s[o]);return i}({1:[function(e){"use strict";function t(e){return Math.max.apply(Math,e)}function n(e){return e.fromNow(!0).replace(/^an? /,"")}function s(e){return 1==e?"":"s"}function i(e){document.title=e?e+" | "+g:g}function a(e){var t,n=!!e.url;return t=e.dead?"[dead] "+e.title:n?m.DOM.a({href:e.url},e.title):f({to:e.type,params:{id:e.id}},e.title),m.DOM.div({className:"Item__title"},t,n&&" ",n&&m.DOM.span({className:"Item__host"},"(",D(e.url),")"))}function o(e,n,i){var a=r(1e3*e.time),o="job"!=e.type,l=e.kids&&e.kids.length>0?"comments":"discuss";null!==n.lastVisit&&(l=n.commentCount+" comment"+s(n.commentCount)),i&&(l=f({to:e.type,params:{id:e.id}},l));var d=i&&null!==n.lastVisit&&t(e.kids)>n.prevMaxCommentId;return m.DOM.div({className:"Item__meta"},o&&m.DOM.span({className:"Item__score"},e.score," point",s(e.score))," ",o&&m.DOM.span({className:"Item__by"},"by ",f({to:"user",params:{id:e.by}},e.by))," ",m.DOM.span({className:"Item__time"},a.fromNow()),o&&" | ",o&&l,i&&null!==n.lastVisit&&" ("+n.lastVisit.fromNow()+")",d&&" | ",d&&f({className:"Item__newcomments",to:"item",params:{id:e.id},query:{showNew:!0}},"new comments"))}var r=e("moment"),m=e("react/addons"),l=e("reactfire"),d=e("react-router"),u=e("./buildClassName"),c=e("./CommentThreadStore"),p=e("./ItemStore");window.React=m;var h=d.DefaultRoute,f=d.Link,v=d.Navigation,N=d.NotFoundRoute,C=d.Route,M=d.Routes,O=30,g="React Hacker News",D=function(){var e=document.createElement("a");return function(t){e.href=t;var n=e.hostname.split(".").slice(-3);return"www"===n[0]&&n.shift(),n.join(".")}}(),_=m.createClass({displayName:"Spinner",getDefaultProps:function(){return{size:6,spacing:2}},render:function(){var e=this.props.size+"px",t={height:e,width:e,marginRight:this.props.spacing+"px"};return m.DOM.div({className:"Spinner",style:{width:3*(this.props.size+this.props.spacing)+"px"}},m.DOM.div({className:"bounce1",style:t}),m.DOM.div({className:"bounce2",style:t}),m.DOM.div({className:"bounce3",style:t}))}}),b=m.createClass({displayName:"NotFound",render:function(){return m.DOM.h2(null,"Not found")}}),I=m.createClass({displayName:"UserProfile",mixins:[l],getInitialState:function(){return{user:{}}},componentWillMount:function(){this.bindAsObject(p.userRef(this.props.params.id),"user")},componentWillUpdate:function(e,t){this.state.user.id!=t.user.id&&i("Profile: "+t.user.id)},componentWillReceiveProps:function(e){this.props.params.id!=e.params.id&&(this.unbind("user"),this.bindAsObject(p.userRef(e.params.id),"user"))},render:function(){var e=this.state.user;if(!e.id)return m.DOM.div({className:"UserProfile UserProfile--loading"},m.DOM.h4(null,this.props.params.id),_({size:"20"}));var t=r(1e3*e.created);return m.DOM.div({className:"UserProfile"},m.DOM.h4(null,e.id),m.DOM.dl(null,m.DOM.dt(null,"Created"),m.DOM.dd(null,t.fromNow()," (",t.format("LL"),")"),m.DOM.dt(null,"Karma"),m.DOM.dd(null,e.karma),m.DOM.dt(null,"Delay"),m.DOM.dd(null,e.delay),e.about&&m.DOM.dt(null,"About"),e.about&&m.DOM.dd(null,m.DOM.div({className:"UserProfile__about",dangerouslySetInnerHTML:{__html:e.about}}))))}}),y=m.createClass({displayName:"Comment",mixins:[l,v],getDefaultProps:function(){return{showSpinner:!1,permalink:!1,permalinkThread:!1,level:0,maxCommentId:0}},getInitialState:function(){return{comment:{},parent:{type:"comment"},collapsed:!1}},componentWillMount:function(){this.bindAsObject(p.itemRef(this.props.id||this.props.params.id),"comment"),this.isInPermalinkThread()||c.addComment(this.props.id)},componentWillUpdate:function(e,t){if(this.props.permalinked&&this.state.comment.id!=t.comment.id){if("comment"!=t.comment.type)return void this.replaceWith(t.comment.type,{id:t.comment.id});p.fetchItem(t.comment.id,function(e){this.setState({parent:e})}.bind(this)),i("Comment by "+t.comment.by)}},componentWillReceiveProps:function(e){this.props.permalinked&&this.props.params.id!=e.params.id&&(this.unbind("comment"),this.bindAsObject(p.itemRef(e.params.id),"comment"))},isInPermalinkThread:function(){return this.props.permalinked||this.props.permalinkThread},isNew:function(){return this.props.maxCommentId>0&&this.props.id>this.props.maxCommentId},toggleCollapsed:function(){this.setState({collapsed:!this.state.collapsed})},render:function(){var e=this.props,t=this.state.comment;return t.id?"comment"!=t.type?null:t.deleted&&!t.kids?null:m.DOM.div({className:u("Comment Comment--level"+e.level,{"Comment--collapsed":this.state.collapsed,"Comment--dead":t.dead,"Comment--deleted":t.deleted,"Comment--new":this.isNew()})},m.DOM.div({className:"Comment__content"},t.deleted&&m.DOM.div({className:"Comment__meta"},this.renderCollapseControl()," ","[deleted]"),!t.deleted&&m.DOM.div({className:"Comment__meta"},m.DOM.span({className:"Comment__collapse",onClick:this.toggleCollapsed,onKeyPress:this.toggleCollapsed,tabIndex:"0"},"[",this.state.collapsed?"+":"â€“","]")," ",f({to:"user",params:{id:t.by},className:"Comment__user"},t.by)," ",r(1e3*t.time).fromNow()," | ",!e.permalinked&&f({to:"comment",params:{id:t.id}},"link"),e.permalinked&&f({to:this.state.parent.type,params:{id:t.parent}},"parent"),t.dead&&" | [dead]"),!t.deleted&&m.DOM.div({className:"Comment__text"},m.DOM.div({dangerouslySetInnerHTML:{__html:t.text}}))),t.kids&&m.DOM.div({className:"Comment__kids"},t.kids.map(function(t,n){return y({key:t,id:t,level:e.level+1,showSpinner:e.showSpinner||e.permalinked&&0===n,permalinkThread:e.permalinkThread||e.permalinked,maxCommentId:e.maxCommentId})}))):m.DOM.div({className:u("Comment Comment--loading Comment--level"+e.level,{"Comment--new":this.isNew()})},(e.permalinked||e.showSpinner)&&_({size:"20"}),t.error&&m.DOM.p(null,"Error loading comment - this may be because the author has configured a delay."))}}),w=m.createClass({displayName:"PollOption",mixins:[l],getInitialState:function(){return{pollopt:{}}},componentWillMount:function(){this.bindAsObject(p.itemRef(this.props.id),"pollopt")},render:function(){var e=this.state.pollopt;return e.id?m.DOM.div({className:"PollOption"},m.DOM.div({className:"PollOption__text"},e.text),m.DOM.div({className:"PollOption__score"},e.score," point",s(e.score))):m.DOM.div({className:"PollOption PollOption--loading"})}}),x=m.createClass({displayName:"Item",mixins:[l],getInitialState:function(){var e=c.getCommentStats(this.props.params.id);return{item:{},lastVisit:e.lastVisit,commentCount:e.commentCount,prevMaxCommentId:e.prevMaxCommentId,newCommentCount:0}},componentWillMount:function(){this.bindAsObject(p.itemRef(this.props.params.id),"item"),this.setState(c.init(this.props.params.id,this.handleCommentsAdded)),window.addEventListener("beforeunload",this.handleBeforeUnload)},componentWillUnmount:function(){c.dispose(),window.removeEventListener("beforeunload",this.handleBeforeUnload)},componentWillUpdate:function(e,t){this.state.item.id!=t.item.id&&i(t.item.title)},componentWillReceiveProps:function(e){this.props.params.id!=e.params.id&&(this.unbind("item"),this.bindAsObject(p.itemRef(e.params.id),"item"),c.dispose(),this.setState(c.init(e.params.id,this.handleCommentsAdded)))},handleBeforeUnload:function(){c.dispose()},isInitialLoad:function(){return null===this.state.lastVisit},handleCommentsAdded:function(e){var t={newCommentCount:e.newCommentCount};e.commentCount>this.state.commentCount&&(t.commentCount=e.commentCount),this.setState(t)},markAsRead:function(){this.setState(c.markAsRead())},render:function(){var e=this.state,t=e.item,i=e.newCommentCount;return t.id?m.DOM.div({className:u("Item",{"Item--dead":t.dead})},m.DOM.div({className:"Item__content"},a(t),o(t,e),i>0&&m.DOM.div({className:"Item__newcomments"},i," new comment",s(i)," in the last ",n(e.lastVisit)," ","| ",m.DOM.span({className:"control",tabIndex:"0",onClick:this.markAsRead,onKeyPress:this.markAsRead},"mark as read")),t.text&&m.DOM.div({className:"Item__text"},m.DOM.div({dangerouslySetInnerHTML:{__html:t.text}})),"poll"==t.type&&m.DOM.div({className:"Item__poll"},t.parts.map(function(e){return w({key:e,id:e})}))),t.kids&&m.DOM.div({className:"Item__kids"},t.kids.map(function(t,n){return y({key:t,id:t,level:0,showSpinner:0===n,maxCommentId:e.prevMaxCommentId})}))):m.DOM.div({className:"Item Item--loading"},_({size:"20"}))}}),k=m.createClass({displayName:"ListItem",mixins:[l],getInitialState:function(){return{item:{},lastVisit:null,commentCount:null,prevMaxCommentId:null}},componentWillMount:function(){this.bindAsObject(p.itemRef(this.props.id),"item"),this.setState(c.getCommentStats(this.props.id))},render:function(){var e=this.state.item;return e.id?e.deleted?null:m.DOM.li({className:u("ListItem",{"ListItem--dead":e.dead})},a(e),o(e,this.state,!0)):m.DOM.li({className:"ListItem ListItem--loading"},_(null))}}),S=m.createClass({displayName:"Items",mixins:[l],getInitialState:function(){return{items:[]}},componentWillMount:function(){this.bindAsObject(p.topStoriesRef(),"items"),i()},getPage:function(){return this.props.query.page&&/^\d+$/.test(this.props.query.page)?Math.max(1,Number(this.props.query.page)):1},render:function(){var e=this.getPage(),t=(e-1)*O,n=t+O,s=n<this.state.items.length-1;if(0===this.state.items.length){for(var i=[],a=0;O>a;a++)i.push(m.DOM.li({className:"ListItem ListItem--loading"},_(null)));return m.DOM.div({className:"Items Items--loading"},m.DOM.ol({className:"Items__list",start:t+1},i),R({route:"news",page:e,hasNext:s}))}var o=this.state.items.slice(t,n);return m.DOM.div({className:"Items"},m.DOM.ol({className:"Items__list",start:t+1},o.map(function(e){return k({key:e,id:e})})),R({route:"news",page:e,hasNext:s}))}}),R=m.createClass({displayName:"Paginator",render:function(){return m.DOM.div({className:"Paginator"},this.props.page>1&&m.DOM.span({className:"Paginator__prev"},f({to:this.props.route,query:{page:this.props.page-1}},"Prev")),this.props.page>1&&this.props.hasNext&&" | ",this.props.hasNext&&m.DOM.span({className:"Paginator__next"},f({to:this.props.route,query:{page:this.props.page+1}},"More")))}}),P=m.createClass({displayName:"App",render:function(){return m.DOM.div({className:"App"},m.DOM.div({className:"App__header"},m.DOM.img({src:"logo.png",width:"16",height:"16",alt:""})," ",f({to:"news",className:"App__homelink"},"React Hacker News")),m.DOM.div({className:"App__content"},this.props.activeRouteHandler(null)),m.DOM.div({className:"App__footer"},m.DOM.a({href:"https://github.com/insin/react-hn"},"Source on GitHub")))}}),A=M({location:"hash"},C({name:"app",path:"/",handler:P},h({handler:S}),N({handler:b}),C({name:"news",path:"news",handler:S}),C({name:"item",path:"item/:id",handler:x}),C({name:"job",path:"job/:id",handler:x}),C({name:"poll",path:"poll/:id",handler:x}),C({name:"story",path:"story/:id",handler:x}),C({name:"comment",path:"comment/:id",handler:y,permalinked:!0}),C({name:"user",path:"user/:id",handler:I})));m.renderComponent(A,document.getElementById("app"))},{"./CommentThreadStore":2,"./ItemStore":3,"./buildClassName":4,moment:"moment","react-router":"react-router","react/addons":"react/addons",reactfire:"reactfire"}],2:[function(e,t){"use strict";function n(){a.set(l+o,u),a.set(l+r,Date.now()),a.set(l+m,p)}var s=e("moment"),i=e("./cancellableDebounce"),a=e("./storage"),o=":cc",r=":lv",m=":mc",l=null,d=null,u=null,c=null,p=null,h=null,f=null,v=i(function(){d({commentCount:u,newCommentCount:c})},100),N=i(function(){h=p,f=!1},5e3);t.exports={init:function(e,t){l=e,d=t,u=0,c=0,p=0,h=a.get(l+m,null),f=null===h,null!==h&&(h=Number(h));var n=a.get(l+r,null);return{lastVisit:null!==n?s(Number(n)):s()}},dispose:function(){null!==l&&(v.cancel(),n(),l=null,d=null)},markAsRead:function(){return c=0,h=p,n(),{lastVisit:s(),prevMaxCommentId:h,newCommentCount:c}},addComment:function(e){u++;var t=null!==h&&e>h;t&&c++,e>p&&(p=e),v(),f&&N()},getCommentStats:function(e){var t=a.get(e+r,null);return{lastVisit:null!==t?s(Number(t)):null,commentCount:Number(a.get(e+o,"0")),prevMaxCommentId:Number(a.get(e+m,"0"))}}}},{"./cancellableDebounce":5,"./storage":6,moment:"moment"}],3:[function(e,t){"use strict";var n=e("firebase"),s=new n("https://hacker-news.firebaseio.com/v0");t.exports={topStoriesRef:function(){return s.child("topstories")},itemRef:function(e){return s.child("item/"+e)},userRef:function(e){return s.child("user/"+e)},fetchItem:function(e,t){this.itemRef(e).once("value",function(e){t(e.val())})}}},{firebase:"firebase"}],4:[function(e,t){"use strict";function n(e,t){var n=[];"undefined"==typeof t?t=e:n.push(e);for(var s=Object.keys(t),i=0,a=s.length;a>i;i++)t[s[i]]&&n.push(s[i]);return n.join(" ")}t.exports=n},{}],5:[function(e,t){"use strict";function n(e,t,n){var s,i,a,o,r,m=function(){var l=Date.now()-o;t>l&&l>0?s=setTimeout(m,t-l):(s=null,n||(r=e.apply(a,i),s||(a=i=null)))},l=function(){a=this,i=arguments,o=Date.now();var l=n&&!s;return s||(s=setTimeout(m,t)),l&&(r=e.apply(a,i),a=i=null),r};return l.cancel=function(){s&&clearTimeout(s)},l}t.exports=n},{}],6:[function(e,t){"use strict";t.exports={get:function(e,t){var n=localStorage[e];return"undefined"!=typeof n?n:t},set:function(e,t){localStorage[e]=t}}},{}]},{},[1]);