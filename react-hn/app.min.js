!function e(t,n,s){function i(o,r){if(!n[o]){if(!t[o]){var l="function"==typeof require&&require;if(!r&&l)return l(o,!0);if(a)return a(o,!0);var m=new Error("Cannot find module '"+o+"'");throw m.code="MODULE_NOT_FOUND",m}var d=n[o]={exports:{}};t[o][0].call(d.exports,function(e){var n=t[o][1][e];return i(n?n:e)},d,d.exports,e,t,n,s)}return n[o].exports}for(var a="function"==typeof require&&require,o=0;o<s.length;o++)i(s[o]);return i}({1:[function(e){"use strict";function t(e){return Math.max.apply(Math,e)}function n(e){return e.fromNow(!0).replace(/^an? /,"")}function s(e){return 1==e?"":"s"}function i(e){document.title=e?e+" | "+_:_}function a(e){var t,n=!!e.url;return t=e.dead?"[dead] "+e.title:n?m.DOM.a({href:e.url},e.title):f({to:e.type,params:{id:e.id}},e.title),m.DOM.div({className:"Item__title"},t,n&&" ",n&&m.DOM.span({className:"Item__host"},"(",C(e.url),")"))}function o(e,n,i){var a=l(1e3*e.time),o="job"!=e.type,r=e.kids&&e.kids.length>0?"comments":"discuss";null!==n.lastVisit&&(r=n.commentCount+" comment"+s(n.commentCount)),i&&(r=f({to:e.type,params:{id:e.id}},r));var d=i&&null!==n.lastVisit&&t(e.kids)>n.prevMaxCommentId;return m.DOM.div({className:"Item__meta"},o&&m.DOM.span({className:"Item__score"},e.score," point",s(e.score))," ",o&&m.DOM.span({className:"Item__by"},"by ",f({to:"user",params:{id:e.by}},e.by))," ",m.DOM.span({className:"Item__time"},a.fromNow()),o&&" | ",o&&r,i&&null!==n.lastVisit&&" ("+n.lastVisit.fromNow()+")",d&&" | ",d&&f({className:"Item__newcomments",to:"item",params:{id:e.id},query:{showNew:!0}},"new comments"))}var r=e("firebase"),l=e("moment"),m=e("react/addons"),d=e("reactfire"),u=e("react-router"),c=e("./CommentThreadStore");window.React=m;var p=m.addons.classSet,h=u.DefaultRoute,f=u.Link,v=u.Navigation,N=u.NotFoundRoute,O=u.Route,M=u.Routes,D="https://hacker-news.firebaseio.com/v0/item/",g=30,_="React Hacker News",b="https://hacker-news.firebaseio.com/v0/topstories",w="https://hacker-news.firebaseio.com/v0/user/",C=function(){var e=document.createElement("a");return function(t){e.href=t;var n=e.hostname.split(".").slice(-3);return"www"===n[0]&&n.shift(),n.join(".")}}(),y=m.createClass({displayName:"Spinner",getDefaultProps:function(){return{size:6,spacing:2}},render:function(){var e=this.props.size+"px",t={height:e,width:e,marginRight:this.props.spacing+"px"};return m.DOM.div({className:"Spinner",style:{width:3*(this.props.size+this.props.spacing)+"px"}},m.DOM.div({className:"bounce1",style:t}),m.DOM.div({className:"bounce2",style:t}),m.DOM.div({className:"bounce3",style:t}))}}),I=m.createClass({displayName:"NotFound",render:function(){return m.DOM.h2(null,"Not found")}}),x=m.createClass({displayName:"User",mixins:[d],getInitialState:function(){return{user:{}}},componentWillMount:function(){this.bindAsObject(new r(w+this.props.params.id),"user")},componentWillUpdate:function(e,t){this.state.user.id!=t.user.id&&i("Profile: "+t.user.id)},componentWillReceiveProps:function(e){this.props.params.id!=e.params.id&&(this.unbind("user"),this.bindAsObject(new r(w+e.params.id),"user"))},render:function(){var e=this.state.user;if(!e.id)return m.DOM.div({className:"User User--loading"},m.DOM.h4(null,this.props.params.id),y({size:"20"}));var t=l(1e3*e.created);return m.DOM.div({className:"User"},m.DOM.h4(null,e.id),m.DOM.dl(null,m.DOM.dt(null,"Created"),m.DOM.dd(null,t.fromNow()," (",t.format("LL"),")"),m.DOM.dt(null,"Karma"),m.DOM.dd(null,e.karma),m.DOM.dt(null,"Delay"),m.DOM.dd(null,e.delay),e.about&&m.DOM.dt(null,"About"),e.about&&m.DOM.dd(null,m.DOM.div({className:"User__about",dangerouslySetInnerHTML:{__html:e.about}}))))}}),k=m.createClass({displayName:"Comment",mixins:[d,v],getDefaultProps:function(){return{showSpinnerDeep:!1,isPermalinkThread:!1}},getInitialState:function(){return{comment:{},collapsed:!1,isNew:!1}},componentWillMount:function(){this.bindAsObject(new r(D+(this.props.id||this.props.params.id)),"comment"),this.props.isPermalinkThread||this.isTopLevel()||this.setState(c.addComment(this.props.id))},componentWillUpdate:function(e,t){if(this.isTopLevel()&&this.state.comment.id!=t.comment.id){if("comment"!=t.comment.type)return void this.replaceWith(t.comment.type,{id:t.comment.id});i("Comment by "+t.comment.by)}},componentWillReceiveProps:function(e){this.isTopLevel()&&this.props.params.id!=e.params.id&&(this.unbind("comment"),this.bindAsObject(new r(D+e.params.id),"comment"))},isTopLevel:function(){return!!this.props.params},toggleCollapsed:function(){this.setState({collapsed:!this.state.collapsed})},render:function(){var e=this.state.comment,t=this.isTopLevel(),n=this.props.showSpinnerDeep,s=this.props.isPermalinkThread;if(!e.id)return m.DOM.div({className:p({"Comment Comment--loading":!0,"Comment--new":this.state.isNew})},(t||n)&&y({size:"20"}),e.error&&m.DOM.p(null,"Error loading comment - this may be because the author has configured a delay."));if("comment"!=e.type)return null;if(e.deleted&&!e.kids)return null;var i=p({Comment:!0,"Comment--collapsed":this.state.collapsed,"Comment--dead":e.dead,"Comment--deleted":e.deleted,"Comment--new":this.state.isNew}),a=l(1e3*e.time);return m.DOM.div({className:i},e.deleted&&m.DOM.div({className:"Comment__meta"},this.renderCollapseControl()," ","[deleted]"),!e.deleted&&m.DOM.div({className:"Comment__meta"},m.DOM.span({className:"Comment__collapse",onClick:this.toggleCollapsed,onKeyPress:this.toggleCollapsed,tabIndex:"0"},"[",this.state.collapsed?"+":"â€“","]")," ",f({to:"user",params:{id:e.by},className:"Comment__user"},e.by)," ",a.fromNow()," | ",!t&&f({to:"comment",params:{id:e.id}},"link"),t&&f({to:"comment",params:{id:e.parent}},"parent"),e.dead&&" | [dead]"),!e.deleted&&m.DOM.div({className:"Comment__text"},m.DOM.div({dangerouslySetInnerHTML:{__html:e.text}})),e.kids&&m.DOM.div({className:"Comment__kids"},e.kids.map(function(e,i){return k({key:e,id:e,showSpinnerDeep:n||t&&0===i,isPermalinkThread:s||t})})))}}),S=m.createClass({displayName:"PollOption",mixins:[d],getInitialState:function(){return{pollopt:{}}},componentWillMount:function(){this.bindAsObject(new r(D+this.props.id),"pollopt")},render:function(){var e=this.state.pollopt;return e.id?m.DOM.div({className:"PollOption"},m.DOM.div({className:"PollOption__text"},e.text),m.DOM.div({className:"PollOption__score"},e.score," point",s(e.score))):m.DOM.div({className:"PollOption PollOption--loading"})}}),P=m.createClass({displayName:"Item",mixins:[d],getInitialState:function(){return{item:{},lastVisit:null,comentCount:null,newCommentCount:null}},componentWillMount:function(){this.bindAsObject(new r(D+this.props.params.id),"item"),this.setState(c.init(this.props.params.id,this.handleCommentsAdded)),window.addEventListener("beforeunload",this.handleBeforeUnload)},componentWillUnmount:function(){c.dispose(),window.removeEventListener("beforeunload",this.handleBeforeUnload)},componentWillUpdate:function(e,t){this.state.item.id!=t.item.id&&i(t.item.title)},componentWillReceiveProps:function(e){this.props.params.id!=e.params.id&&(this.unbind("item"),this.bindAsObject(new r(D+e.params.id),"item"),c.dispose(),this.setState(c.init(e.params.id,this.handleCommentsAdded)))},handleBeforeUnload:function(){c.dispose()},handleCommentsAdded:function(e){this.setState(e)},render:function(){var e=this.state.item,t=this.state.newCommentCount;return e.id?m.DOM.div({className:p({Item:!0,"Item--dead":e.dead})},a(e),o(e,this.state),t>0&&m.DOM.div({className:"Item__newcomments"},t," new comment",s(t)," in the last ",n(this.state.lastVisit)),e.text&&m.DOM.div({className:"Item__text"},m.DOM.div({dangerouslySetInnerHTML:{__html:e.text}})),"poll"==e.type&&m.DOM.div({className:"Item__poll"},e.parts.map(function(e){return S({key:e,id:e})})),e.kids&&m.DOM.div({className:"Item__kids"},e.kids.map(function(e,t){return k({key:e,id:e,showSpinnerDeep:0===t})}))):m.DOM.div({className:"Item Item--loading"},y({size:"20"}))}}),L=m.createClass({displayName:"ListItem",mixins:[d],getInitialState:function(){return{item:{},lastVisit:null,commentCount:null,prevMaxCommentId:null}},componentWillMount:function(){this.bindAsObject(new r(D+this.props.id),"item"),this.setState(c.getCommentStats(this.props.id))},render:function(){var e=this.state.item;return e.id?e.deleted?null:m.DOM.li({className:p({ListItem:!0,"ListItem--dead":e.dead})},a(e),o(e,this.state,!0)):m.DOM.li({className:"ListItem ListItem--loading"},y(null))}}),A=m.createClass({displayName:"Items",mixins:[d],getInitialState:function(){return{items:[]}},componentWillMount:function(){this.bindAsObject(new r(b),"items"),i()},getPage:function(){return this.props.query.page&&/^\d+$/.test(this.props.query.page)?Math.max(1,Number(this.props.query.page)):1},render:function(){var e=this.getPage(),t=(e-1)*g;if(0===this.state.items.length){for(var n=[],s=0;g>s;s++)n.push(m.DOM.li({className:"ListItem ListItem--loading"},y(null)));return m.DOM.div({className:"Items Items--loading"},m.DOM.ol({className:"Items__list",start:t+1},n))}var i=t+g,a=this.state.items.slice(t,i),o=i<this.state.items.length-1;return m.DOM.div({className:"Items"},e>1&&T({route:"news",page:e,hasNext:o}),m.DOM.ol({className:"Items__list",start:t+1},a.map(function(e){return L({key:e,id:e})})),T({route:"news",page:e,hasNext:o}))}}),T=m.createClass({displayName:"Paginator",render:function(){return m.DOM.div({className:"Paginator"},this.props.page>1&&m.DOM.span({className:"Paginator__prev"},f({to:this.props.route,query:{page:this.props.page-1}},"Prev")),this.props.page>1&&this.props.hasNext&&" | ",this.props.hasNext&&m.DOM.span({className:"Paginator__next"},f({to:this.props.route,query:{page:this.props.page+1}},"More")))}}),U=m.createClass({displayName:"App",render:function(){return m.DOM.div({className:"App"},m.DOM.div({className:"App__header"},m.DOM.img({src:"logo.png",width:"16",height:"16",alt:""})," ",f({to:"news",className:"App__homelink"},"React Hacker News")),m.DOM.div({className:"App__content"},this.props.activeRouteHandler(null)))}}),W=M({location:"hash"},O({name:"app",path:"/",handler:U},h({handler:A}),N({handler:I}),O({name:"news",path:"news",handler:A}),O({name:"item",path:"item/:id",handler:P}),O({name:"job",path:"job/:id",handler:P}),O({name:"poll",path:"poll/:id",handler:P}),O({name:"story",path:"story/:id",handler:P}),O({name:"comment",path:"comment/:id",handler:k}),O({name:"user",path:"user/:id",handler:x})));m.renderComponent(W,document.getElementById("app"))},{"./CommentThreadStore":2,firebase:"firebase",moment:"moment","react-router":"react-router","react/addons":"react/addons",reactfire:"reactfire"}],2:[function(e,t){"use strict";var n=e("moment"),s=e("./cancellableDebounce"),i=e("./storage"),a=":cc",o=":lv",r=":mc",l=null,m=null,d=null,u=null,c=null,p=null,h=null,f=s(function(){m({commentCount:d,newCommentCount:u})},100),v=s(function(){p=c,h=!1},5e3);t.exports={init:function(e,t){l=e,m=t,d=0,u=0,c=0,p=i.get(l+r,null),h=null===p,null!==p&&(p=Number(p));var s=i.get(l+o,null);return{lastVisit:null!==s?n(Number(s)):n()}},dispose:function(){null!==l&&(f.cancel(),i.set(l+a,d),i.set(l+o,Date.now()),i.set(l+r,c),l=null,m=null)},addComment:function(e){d++;var t=null!==p&&e>p;return t&&u++,e>c&&(c=e),f(),h&&v(),{isNew:t}},getCommentStats:function(e){var t=i.get(e+o,null);return{lastVisit:null!==t?n(Number(t)):null,commentCount:Number(i.get(e+a,"-1")),prevMaxCommentId:Number(i.get(e+r,"-1"))}}}},{"./cancellableDebounce":3,"./storage":4,moment:"moment"}],3:[function(e,t){"use strict";function n(e,t,n){var s,i,a,o,r,l=function(){var m=Date.now()-o;t>m&&m>0?s=setTimeout(l,t-m):(s=null,n||(r=e.apply(a,i),s||(a=i=null)))},m=function(){a=this,i=arguments,o=Date.now();var m=n&&!s;return s||(s=setTimeout(l,t)),m&&(r=e.apply(a,i),a=i=null),r};return m.cancel=function(){s&&clearTimeout(s)},m}t.exports=n},{}],4:[function(e,t){"use strict";t.exports={get:function(e,t){var n=localStorage[e];return"undefined"!=typeof n?n:t},set:function(e,t){localStorage[e]=t}}},{}]},{},[1]);