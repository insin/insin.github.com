!function e(t,n,s){function i(o,r){if(!n[o]){if(!t[o]){var l="function"==typeof require&&require;if(!r&&l)return l(o,!0);if(a)return a(o,!0);var m=new Error("Cannot find module '"+o+"'");throw m.code="MODULE_NOT_FOUND",m}var d=n[o]={exports:{}};t[o][0].call(d.exports,function(e){var n=t[o][1][e];return i(n?n:e)},d,d.exports,e,t,n,s)}return n[o].exports}for(var a="function"==typeof require&&require,o=0;o<s.length;o++)i(s[o]);return i}({1:[function(e){"use strict";function t(e){return Math.max.apply(Math,e)}function n(e){return e.fromNow(!0).replace(/^an? /,"")}function s(e){return 1==e?"":"s"}function i(e){document.title=e?e+" | "+D:D}function a(e){var t,n=!!e.url;return t=e.dead?"[dead] "+e.title:n?l.DOM.a({href:e.url},e.title):f({to:e.type,params:{id:e.id}},e.title),l.DOM.div({className:"Item__title"},t,n&&" ",n&&l.DOM.span({className:"Item__host"},"(",g(e.url),")"))}function o(e,t,n,i){var a=r(1e3*e.time),o="job"!=e.type,m=e.kids&&e.kids.length>0?"comments":"discuss";return null!==t.lastVisit&&(m=t.commentCount+" comment"+s(t.commentCount)),"list"==n&&(m=f({to:e.type,params:{id:e.id}},m)),l.DOM.div({className:"Item__meta"},o&&l.DOM.span({className:"Item__score"},e.score," point",s(e.score))," ",o&&l.DOM.span({className:"Item__by"},"by ",f({to:"user",params:{id:e.by}},e.by))," ",l.DOM.span({className:"Item__time"},a.fromNow()),o&&" | ",o&&m,i)}var r=e("moment"),l=e("react/addons"),m=e("reactfire"),d=e("react-router"),u=e("./buildClassName"),p=e("./CommentThreadStore"),c=e("./ItemStore");window.React=l;var h=d.DefaultRoute,f=d.Link,v=d.Navigation,M=d.NotFoundRoute,C=d.Route,O=d.Routes,N=30,D="React Hacker News",g=function(){var e=document.createElement("a");return function(t){e.href=t;var n=e.hostname.split(".").slice(-3);return"www"===n[0]&&n.shift(),n.join(".")}}(),b=l.createClass({displayName:"Spinner",getDefaultProps:function(){return{size:6,spacing:2}},render:function(){var e=this.props.size+"px",t={height:e,width:e,marginRight:this.props.spacing+"px"};return l.DOM.div({className:"Spinner",style:{width:3*(this.props.size+this.props.spacing)+"px"}},l.DOM.div({className:"bounce1",style:t}),l.DOM.div({className:"bounce2",style:t}),l.DOM.div({className:"bounce3",style:t}))}}),_=l.createClass({displayName:"NotFound",render:function(){return l.DOM.h2(null,"Not found")}}),y=l.createClass({displayName:"UserProfile",mixins:[m],getInitialState:function(){return{user:{}}},componentWillMount:function(){this.bindAsObject(c.userRef(this.props.params.id),"user")},componentWillUpdate:function(e,t){this.state.user.id!=t.user.id&&i("Profile: "+t.user.id)},componentWillReceiveProps:function(e){this.props.params.id!=e.params.id&&(this.unbind("user"),this.bindAsObject(c.userRef(e.params.id),"user"))},render:function(){var e=this.state.user;if(!e.id)return l.DOM.div({className:"UserProfile UserProfile--loading"},l.DOM.h4(null,this.props.params.id),b({size:"20"}));var t=r(1e3*e.created);return l.DOM.div({className:"UserProfile"},l.DOM.h4(null,e.id),l.DOM.dl(null,l.DOM.dt(null,"Created"),l.DOM.dd(null,t.fromNow()," (",t.format("LL"),")"),l.DOM.dt(null,"Karma"),l.DOM.dd(null,e.karma),l.DOM.dt(null,"Delay"),l.DOM.dd(null,e.delay),e.about&&l.DOM.dt(null,"About"),e.about&&l.DOM.dd(null,l.DOM.div({className:"UserProfile__about",dangerouslySetInnerHTML:{__html:e.about}}))))}}),I=l.createClass({displayName:"Comment",mixins:[m,v],getDefaultProps:function(){return{showSpinner:!1,permalink:!1,permalinkThread:!1,level:0,maxCommentId:0}},getInitialState:function(){return{comment:{},parent:{type:"comment"},collapsed:!1}},componentWillMount:function(){this.bindAsObject(c.itemRef(this.props.id||this.props.params.id),"comment"),this.isInPermalinkThread()||p.addComment(this.props.id)},componentWillUpdate:function(e,t){if(this.props.permalinked&&this.state.comment.id!=t.comment.id){if("comment"!=t.comment.type)return void this.replaceWith(t.comment.type,{id:t.comment.id});c.fetchItem(t.comment.id,function(e){this.setState({parent:e})}.bind(this)),i("Comment by "+t.comment.by)}},componentWillReceiveProps:function(e){this.props.permalinked&&this.props.params.id!=e.params.id&&(this.unbind("comment"),this.bindAsObject(c.itemRef(e.params.id),"comment"))},isInPermalinkThread:function(){return this.props.permalinked||this.props.permalinkThread},isNew:function(){return this.props.maxCommentId>0&&this.props.id>this.props.maxCommentId},toggleCollapsed:function(){this.setState({collapsed:!this.state.collapsed})},render:function(){var e=this.props,t=this.state.comment;return t.id?"comment"!=t.type?null:t.deleted&&!t.kids?null:l.DOM.div({className:u("Comment Comment--level"+e.level,{"Comment--collapsed":this.state.collapsed,"Comment--dead":t.dead,"Comment--deleted":t.deleted,"Comment--new":this.isNew()})},l.DOM.div({className:"Comment__content"},t.deleted&&l.DOM.div({className:"Comment__meta"},this.renderCollapseControl()," ","[deleted]"),!t.deleted&&l.DOM.div({className:"Comment__meta"},l.DOM.span({className:"Comment__collapse",onClick:this.toggleCollapsed,onKeyPress:this.toggleCollapsed,tabIndex:"0"},"[",this.state.collapsed?"+":"â€“","]")," ",f({to:"user",params:{id:t.by},className:"Comment__user"},t.by)," ",r(1e3*t.time).fromNow()," | ",!e.permalinked&&f({to:"comment",params:{id:t.id}},"link"),e.permalinked&&f({to:this.state.parent.type,params:{id:t.parent}},"parent"),t.dead&&" | [dead]"),!t.deleted&&l.DOM.div({className:"Comment__text"},l.DOM.div({dangerouslySetInnerHTML:{__html:t.text}}))),t.kids&&l.DOM.div({className:"Comment__kids"},t.kids.map(function(t,n){return I({key:t,id:t,level:e.level+1,showSpinner:e.showSpinner||e.permalinked&&0===n,permalinkThread:e.permalinkThread||e.permalinked,maxCommentId:e.maxCommentId})}))):l.DOM.div({className:u("Comment Comment--loading Comment--level"+e.level,{"Comment--new":this.isNew()})},(e.permalinked||e.showSpinner)&&b({size:"20"}),t.error&&l.DOM.p(null,"Error loading comment - this may be because the author has configured a delay."))}}),w=l.createClass({displayName:"PollOption",mixins:[m],getInitialState:function(){return{pollopt:{}}},componentWillMount:function(){this.bindAsObject(c.itemRef(this.props.id),"pollopt")},render:function(){var e=this.state.pollopt;return e.id?l.DOM.div({className:"PollOption"},l.DOM.div({className:"PollOption__text"},e.text),l.DOM.div({className:"PollOption__score"},e.score," point",s(e.score))):l.DOM.div({className:"PollOption PollOption--loading"})}}),x=l.createClass({displayName:"Item",mixins:[m],getInitialState:function(){var e=p.getCommentStats(this.props.params.id);return{item:{},lastVisit:e.lastVisit,commentCount:e.commentCount,prevMaxCommentId:e.prevMaxCommentId,newCommentCount:0}},componentWillMount:function(){this.bindAsObject(c.itemRef(this.props.params.id),"item"),this.setState(p.init(this.props.params.id,this.handleCommentsAdded)),window.addEventListener("beforeunload",this.handleBeforeUnload)},componentWillUnmount:function(){p.dispose(),window.removeEventListener("beforeunload",this.handleBeforeUnload)},componentWillUpdate:function(e,t){this.state.item.id!=t.item.id&&i(t.item.title)},componentWillReceiveProps:function(e){this.props.params.id!=e.params.id&&(this.unbind("item"),this.bindAsObject(c.itemRef(e.params.id),"item"),p.dispose(),this.setState(p.init(e.params.id,this.handleCommentsAdded)))},handleBeforeUnload:function(){p.dispose()},isInitialLoad:function(){return null===this.state.lastVisit},handleCommentsAdded:function(e){var t={newCommentCount:e.newCommentCount};e.commentCount>this.state.commentCount&&(t.commentCount=e.commentCount),this.setState(t)},markAsRead:function(){this.setState(p.markAsRead())},render:function(){var e=this.state,t=e.item,s=e.newCommentCount;return t.id?l.DOM.div({className:u("Item",{"Item--dead":t.dead})},l.DOM.div({className:"Item__content"},a(t),o(t,e,"detail",s>0&&l.DOM.span(null," ","(",l.DOM.em(null,s," new")," in the last ",n(e.lastVisit),") | ",l.DOM.span({className:"control",tabIndex:"0",onClick:this.markAsRead,onKeyPress:this.markAsRead},"mark as read"))),t.text&&l.DOM.div({className:"Item__text"},l.DOM.div({dangerouslySetInnerHTML:{__html:t.text}})),"poll"==t.type&&l.DOM.div({className:"Item__poll"},t.parts.map(function(e){return w({key:e,id:e})}))),t.kids&&l.DOM.div({className:"Item__kids"},t.kids.map(function(t,n){return I({key:t,id:t,level:0,showSpinner:0===n,maxCommentId:e.prevMaxCommentId})}))):l.DOM.div({className:"Item Item--loading"},b({size:"20"}))}}),k=l.createClass({displayName:"ListItem",mixins:[m],getInitialState:function(){return{item:{},lastVisit:null,commentCount:null,prevMaxCommentId:null}},componentWillMount:function(){this.bindAsObject(c.itemRef(this.props.id),"item"),this.setState(p.getCommentStats(this.props.id))},render:function(){var e=this.state.item;if(!e.id)return l.DOM.li({className:"ListItem ListItem--loading"},b(null));if(e.deleted)return null;var n=null!==this.state.lastVisit&&t(e.kids)>this.state.prevMaxCommentId;return l.DOM.li({className:u("ListItem",{"ListItem--dead":e.dead})},a(e),o(e,this.state,"list",null!==this.state.lastVisit&&l.DOM.span(null," ","(",this.state.lastVisit.fromNow(),")",n&&" | ",n&&f({to:"item",params:{id:e.id}},l.DOM.em(null,"new threads")))))}}),S=l.createClass({displayName:"Items",mixins:[m],getInitialState:function(){return{items:[]}},componentWillMount:function(){this.bindAsObject(c.topStoriesRef(),"items"),i()},getPage:function(){return this.props.query.page&&/^\d+$/.test(this.props.query.page)?Math.max(1,Number(this.props.query.page)):1},render:function(){var e=this.getPage(),t=(e-1)*N,n=t+N,s=n<this.state.items.length-1;if(0===this.state.items.length){for(var i=[],a=0;N>a;a++)i.push(l.DOM.li({className:"ListItem ListItem--loading"},b(null)));return l.DOM.div({className:"Items Items--loading"},l.DOM.ol({className:"Items__list",start:t+1},i),R({route:"news",page:e,hasNext:s}))}var o=this.state.items.slice(t,n);return l.DOM.div({className:"Items"},l.DOM.ol({className:"Items__list",start:t+1},o.map(function(e){return k({key:e,id:e})})),R({route:"news",page:e,hasNext:s}))}}),R=l.createClass({displayName:"Paginator",render:function(){return l.DOM.div({className:"Paginator"},this.props.page>1&&l.DOM.span({className:"Paginator__prev"},f({to:this.props.route,query:{page:this.props.page-1}},"Prev")),this.props.page>1&&this.props.hasNext&&" | ",this.props.hasNext&&l.DOM.span({className:"Paginator__next"},f({to:this.props.route,query:{page:this.props.page+1}},"More")))}}),P=l.createClass({displayName:"App",render:function(){return l.DOM.div({className:"App"},l.DOM.div({className:"App__header"},l.DOM.img({src:"logo.png",width:"16",height:"16",alt:""})," ",f({to:"news",className:"App__homelink"},"React Hacker News")),l.DOM.div({className:"App__content"},this.props.activeRouteHandler(null)),l.DOM.div({className:"App__footer"},l.DOM.a({href:"https://github.com/insin/react-hn"},"Source on GitHub")))}}),A=O({location:"hash"},C({name:"app",path:"/",handler:P},h({handler:S}),M({handler:_}),C({name:"news",path:"news",handler:S}),C({name:"item",path:"item/:id",handler:x}),C({name:"job",path:"job/:id",handler:x}),C({name:"poll",path:"poll/:id",handler:x}),C({name:"story",path:"story/:id",handler:x}),C({name:"comment",path:"comment/:id",handler:I,permalinked:!0}),C({name:"user",path:"user/:id",handler:y})));l.renderComponent(A,document.getElementById("app"))},{"./CommentThreadStore":2,"./ItemStore":3,"./buildClassName":4,moment:"moment","react-router":"react-router","react/addons":"react/addons",reactfire:"reactfire"}],2:[function(e,t){"use strict";function n(){a.set(m+o,u),a.set(m+r,Date.now()),a.set(m+l,c)}var s=e("moment"),i=e("./cancellableDebounce"),a=e("./storage"),o=":cc",r=":lv",l=":mc",m=null,d=null,u=null,p=null,c=null,h=null,f=null,v=i(function(){d({commentCount:u,newCommentCount:p})},100),M=i(function(){h=c,f=!1},5e3);t.exports={init:function(e,t){m=e,d=t,u=0,p=0,c=0,h=a.get(m+l,null),f=null===h,null!==h&&(h=Number(h));var n=a.get(m+r,null);return{lastVisit:null!==n?s(Number(n)):s()}},dispose:function(){null!==m&&(v.cancel(),n(),m=null,d=null)},markAsRead:function(){return p=0,h=c,n(),{lastVisit:s(),prevMaxCommentId:h,newCommentCount:p}},addComment:function(e){u++;var t=null!==h&&e>h;t&&p++,e>c&&(c=e),v(),f&&M()},getCommentStats:function(e){var t=a.get(e+r,null);return{lastVisit:null!==t?s(Number(t)):null,commentCount:Number(a.get(e+o,"0")),prevMaxCommentId:Number(a.get(e+l,"0"))}}}},{"./cancellableDebounce":5,"./storage":6,moment:"moment"}],3:[function(e,t){"use strict";var n=e("firebase"),s=new n("https://hacker-news.firebaseio.com/v0");t.exports={topStoriesRef:function(){return s.child("topstories")},itemRef:function(e){return s.child("item/"+e)},userRef:function(e){return s.child("user/"+e)},fetchItem:function(e,t){this.itemRef(e).once("value",function(e){t(e.val())})}}},{firebase:"firebase"}],4:[function(e,t){"use strict";function n(e,t){var n=[];"undefined"==typeof t?t=e:n.push(e);for(var s=Object.keys(t),i=0,a=s.length;a>i;i++)t[s[i]]&&n.push(s[i]);return n.join(" ")}t.exports=n},{}],5:[function(e,t){"use strict";function n(e,t,n){var s,i,a,o,r,l=function(){var m=Date.now()-o;t>m&&m>0?s=setTimeout(l,t-m):(s=null,n||(r=e.apply(a,i),s||(a=i=null)))},m=function(){a=this,i=arguments,o=Date.now();var m=n&&!s;return s||(s=setTimeout(l,t)),m&&(r=e.apply(a,i),a=i=null),r};return m.cancel=function(){s&&clearTimeout(s)},m}t.exports=n},{}],6:[function(e,t){"use strict";t.exports={get:function(e,t){var n=localStorage[e];return"undefined"!=typeof n?n:t},set:function(e,t){localStorage[e]=t}}},{}]},{},[1]);