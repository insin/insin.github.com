<!DOCTYPE html>
<head>
  <meta charset="UTF-8">
  <title>The Form of Death | newforms-bootstrap</title>
  <script src="http://fb.me/react-0.12.1.min.js"></script>
  <script src="newforms.min.js"></script>
  <script src="newforms-bootstrap.js"></script>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap-theme.min.css">
</head>
<body>
<script>void function() {
'use strict'

function cap(s) {
  return s.charAt(0).toUpperCase() + s.slice(1)
}

var WEB_COLOURS = (
  "|I don't know that!|AliceBlue|AntiqueWhite|Aqua|Aquamarine|Azure|Beige|Bis" +
  'que|Black|BlanchedAlmond|Blue|BlueViolet|Brown|BurlyWood|CadetBlue|Chartre' +
  'use|Chocolate|Coral|CornflowerBlue|Cornsilk|Crimson|Cyan|DarkBlue|DarkCyan' +
  '|DarkGoldenRod|DarkGray|DarkGreen|DarkKhaki|DarkMagenta|DarkOliveGreen|Dar' +
  'kOrange|DarkOrchid|DarkRed|DarkSalmon|DarkSeaGreen|DarkSlateBlue|DarkSlate' +
  'Gray|DarkTurquoise|DarkViolet|DeepPink|DeepSkyBlue|DimGray|DodgerBlue|Fire' +
  'Brick|FloralWhite|ForestGreen|Fuchsia|Gainsboro|GhostWhite|Gold|GoldenRod|' +
  'Gray|Green|GreenYellow|HoneyDew|HotPink|IndianRed|Indigo|Ivory|Khaki|Laven' +
  'der|LavenderBlush|LawnGreen|LemonChiffon|LightBlue|LightCoral|LightCyan|Li' +
  'ghtGoldenRodYellow|LightGray|LightGreen|LightPink|LightSalmon|LightSeaGree' +
  'n|LightSkyBlue|LightSlateGray|LightSteelBlue|LightYellow|Lime|LimeGreen|Li' +
  'nen|Magenta|Maroon|MediumAquaMarine|MediumBlue|MediumOrchid|MediumPurple|M' +
  'ediumSeaGreen|MediumSlateBlue|MediumSpringGreen|MediumTurquoise|MediumViol' +
  'etRed|MidnightBlue|MintCream|MistyRose|Moccasin|NavajoWhite|Navy|OldLace|O' +
  'live|OliveDrab|Orange|OrangeRed|Orchid|PaleGoldenRod|PaleGreen|PaleTurquoi' +
  'se|PaleVioletRed|PapayaWhip|PeachPuff|Peru|Pink|Plum|PowderBlue|Purple|Red' +
  '|RosyBrown|RoyalBlue|SaddleBrown|Salmon|SandyBrown|SeaGreen|SeaShell|Sienn' +
  'a|Silver|SkyBlue|SlateBlue|SlateGray|Snow|SpringGreen|SteelBlue|Tan|Teal|T' +
  'histle|Tomato|Turquoise|Violet|Wheat|White|WhiteSmoke|Yellow|YellowGreen'
).split('|')

var DemoForm = BootstrapForm.extend({
  name: forms.CharField({label: 'Wwhat... is your name?',
                         helpText: 'Note: Sir Robin and Sir Galahad are banned from the Form of Death'}),
  quest: forms.CharField({label: 'Wwhat... is your quest?', widget: forms.Textarea}),
  colour: forms.ChoiceField({label: 'What is your favourite (web) colour?', choices: WEB_COLOURS,
                             helpText: "Note: King Arthur's favourite colour is Bisque"}),
  capital: forms.CharField({label: 'What is the capital of Assyria?', helpText: 'Hint: View Source'}),
  velocity: forms.FloatField({label: 'What is the air-speed velocity of an unladen swallow?', minValue: 0}),

  cleanName:function(cb) {
    var name = this.cleanedData.name
    setTimeout(function() {
      var error = null
      if (/robin|galahad/i.test(name)) {
        error = 'Sir ' + cap(/(robin|galahad)/i.exec(name)[1]) +' shall not pass!'
      }
      cb(null, error)
    }, 1369)
  },

  cleanQuest:function() {
    if (!/grail/i.test(this.cleanedData.quest)) {
      throw forms.ValidationError('WHOOSH! (This is not a worthy quest!)')
    }
  },

  cleanColour:function() {
    if (this.cleanedData.colour == "I don't know that!") {
      throw forms.ValidationError('WHOOSH!')
    }
  },

  cleanCapital:function() {
    if ('Assur|Nimrud|Dur Sarukin|Nineveh'.split('|').indexOf(this.cleanedData.capital) == -1) {
      throw forms.ValidationError('WHOOSH! (View Source!)')
    }
  },

  clean:function() {
    var colour = this.cleanedData.colour
    if (/arthur/i.test(this.cleanedData.name) && colour && colour != 'Bisque') {
      throw forms.ValidationError("Imposter! King Arthur's favourite colour is Bisque! WHOOSH!")
    }
  }
})

var App = React.createClass({displayName: 'App',
  getInitialState:function() {
    return {
      form: new DemoForm({onChange: this.forceUpdate.bind(this)})
    , submitted: null
    }
  },

  _onSubmit:function(e) {
    e.preventDefault()
    var form = this.state.form
    if (form.isComplete()) {
      this.setState({submitted: form.cleanedData})
      return
    }
    form.validate(function(err, isValid, cleanedData) {
      if (isValid) {
        this.setState({submitted: cleanedData})
      }
      else {
        this.forceUpdate()
      }
    }.bind(this))
  },

  render:function() {
    var form = this.state.form
    return React.createElement("div", {className: "container"},
      React.createElement("div", {className: "row"},
        React.createElement("h1", null, "The Form of Death ", React.createElement("small", null, "(some ", React.createElement("a", {href: "https://www.youtube.com/watch?v=cV0tCphFMr8"}, "Monty Python"), " knowledge required)")),
        React.createElement("p", {className: "lead"},
          "Stop! Who would submit the Form of Death must answer me these questions" + ' ' +
          "three, ere the submit button enabled be."
        ),
        React.createElement("p", null,
          "A demo of default form rendering provided by ", React.createElement("code", null, "BootstrapForm"),
          "from ", React.createElement("a", {href: "https://github.com/insin/newforms-bootstrap"}, "newforms bootstrap"), "."
        )
      ),
      React.createElement("div", {className: "row"},
        React.createElement("form", {onSubmit: this._onSubmit},
          this.state.form.render(),
          React.createElement("button", {type: "submit", className: "btn btn-primary", disabled: !form.isComplete()},
            "Submit the Form of Death"
          )
        )
      ),
      React.createElement("div", {className: "row"},
        this.state.submitted && React.createElement("div", {className: "alert alert-success"},
          React.createElement("strong", null, "Submitted data"),
          React.createElement("pre", null, JSON.stringify(this.state.submitted, null, 2))
        )
      )
    )
  }
})

React.render(React.createElement(App, null), document.body)
}()</script>
</body>